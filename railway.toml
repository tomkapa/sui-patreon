# Railway.toml - Service configuration for Railway deployment
# Documentation: https://docs.railway.app/deploy/config-as-code

# Backend API + Indexer Service
[[build]]
builder = "NIXPACKS"
buildCommand = "npm install && cd backend && npm install && npx prisma generate"

[[deploy]]
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
startCommand = "cd backend && npm run start:railway"

[deploy.healthcheck]
path = "/health"
port = 3001

[deploy.healthcheckTimeout]
value = 300

# Web Frontend Service
[[build]]
builder = "NIXPACKS"
buildCommand = "npm install && cd web && npm install && npm run build"

[[deploy]]
numReplicas = 1
restartPolicyType = "ON_FAILURE"
startCommand = "cd web && npm run start"

[deploy.healthcheck]
path = "/"
port = 3000
